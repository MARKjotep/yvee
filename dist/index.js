var Pr=Object.defineProperty;var Lr=(t,r)=>{for(var n in r)Pr(t,n,{get:r[n],enumerable:!0,configurable:!0,set:(o)=>r[n]=()=>o})};var At={};Lr(At,{isWindow:()=>q,isUndefined:()=>Ir,isStr:()=>v,isPromise:()=>Zr,isPlainObject:()=>H,isObject:()=>Fr,isObj:()=>E,isNumber:()=>Z,isNum:()=>St,isNull:()=>lt,isNotWindow:()=>p,isNotNull:()=>qr,isInt:()=>Rt,isFN:()=>w,isDefined:()=>Ur,isClassOrId:()=>Xr,isBool:()=>k,isAsync:()=>Cr,isArraybuff:()=>Br,isArr:()=>g});var w=(t)=>typeof t==="function",Cr=(t)=>t.constructor.name==="AsyncFunction",Zr=(t)=>!!t&&typeof t.then==="function",Z=(t)=>{return!isNaN(parseFloat(t))&&isFinite(t)},Fr=(t)=>{return t&&typeof t==="object"&&!Array.isArray(t)},H=(t)=>{return typeof t==="object"&&t!==null&&Object.getPrototypeOf(t)===Object.prototype&&!Array.isArray(t)},Br=(t)=>{return t instanceof Uint8Array||t instanceof ArrayBuffer||typeof t==="string"},Xr=(t)=>{return t.startsWith(".")||t.startsWith("#")},k=(t)=>typeof t==="boolean",v=(t)=>typeof t==="string",g=(t)=>Array.isArray(t),E=(t)=>typeof t==="object",St=(t)=>typeof t==="number",lt=(t)=>t===null,qr=(t)=>t===null,Ir=(t)=>typeof t==="undefined",Ur=(t)=>typeof t!=="undefined",Rt=(t)=>{return Number.isInteger(Number(t))},q=typeof window!=="undefined",p=typeof window==="undefined";function ct(t,r){l(r).forEach(([n,o])=>{Ot(t,n,{value:o,writable:!1,configurable:!1,enumerable:!0})})}var Dt=(t)=>{return g(t)?t:[t]};class ${static set i(t){console.info(...Dt(t))}static set e(t){console.error(...Dt(t))}static set w(t){console.warn(...Dt(t))}}class D{_c=0;_id="";constructor(t){if(this._c=0,this._id=t??x(5),t?.includes("-")){let[r,n]=[t.split("-").slice(0,-1).join("-"),t.split("-").slice(-1)[0]];this._id=r,this._c=Z(n)?parseInt(n):0}}get id(){return this._id+"-"+this._c}get mid(){return this._id+"-"+ ++this._c}}var Jr=(t)=>Array.from({length:t},(r,n)=>n),kt="ABCDEFGHIJKLMNOPQRSTUVWXYZ",vt="abcdefghijklmnopqrstuvwxyz";var S=(t)=>JSON.stringify(t),tr=(t)=>{return JSON.parse(t)};var M=(t)=>{if(t.startsWith("webkit"))t="-"+t;return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},x=(t)=>{let r=kt+vt,n=Jr(10).join("");return Array.from({length:t},(o,i)=>r+(i?n:"")).reduce((o,i)=>{return o+=i.charAt(Math.floor(Math.random()*i.length))},"")},Wr=(t=6,r)=>{if(!r)return Math.floor(Math.random()*t);return Math.round(Math.random()*(r-t)+t)},rr=()=>{let t=[...kt,...vt],r=Wr(0,t.length);return t[r]};var nr=(t,r)=>{let n=r==="/"?"":r;if(r.startsWith("#"))return t+r;return r.startsWith("/")?t+n:r};class a extends Map{obj(t){t&&l(t).forEach(([r,n])=>this.set(r,n))}map(t){t.forEach((r,n)=>{if(r instanceof a)this.set(n,r);else if(g(r)){if(this.lacks(n))this.set(n,[]);this.get(n).push(...r)}else if(E(r))this.ass(n,r);else this.set(n,r)})}ass(t,r){if(!this.has(t))this.set(t,{});d(this.get(t),r)}lacks(t){return!this.has(t)}init(t,r){return this.has(t)?this.get(t):this.set(t,r).get(t)}}var{values:A,keys:W,entries:l}=Object;var{defineProperty:Ot,assign:d}=Object,or=(t,r)=>Object.hasOwn(t,r),R=(t)=>{return Object.keys(t).length},dt=(t,r)=>{if(!r.has(t))r.set(t,new a);return r.get(t)},tt=(t,r)=>{if(!r.has(t))r.set(t,[]);return r.get(t)},Ht=(t,r)=>{let n={added:{},removed:{},modified:{}},o=W(t),i=W(r);for(let e of i){let f=t[e],s=r[e];if(!(e in t))n.added[e]=s;else if(g(f)&&g(s)){if(S(f)!==S(s))n.modified[e]={old:f,new:s}}else if(E(f)&&E(s)&&!lt(f)&&!lt(s)){let u=Ht(f,s);if(R(u.added)||R(u.removed)||R(u.modified))n.modified[e]={old:f,new:s}}else if(f!==s)n.modified[e]={old:f,new:s}}for(let e of o)if(!(e in r))n.removed[e]=t[e];return n};function ir(t,r){if(t.size!==r.size)return!1;for(let n of t)if(!r.has(n))return!1;return!0}var er=(t)=>{return A(t).some((r)=>{return R(r)})};var I=(t,r)=>{return{name:t,content:r}},Gr=(t,r)=>{return{property:t,content:r}},Qr=(t,r)=>{return{"http-equiv":t,content:r}};class rt{metas=[];constructor(t){t&&this.metas.push(I("description",t))}author(t){return this.meta=I("author",t),this}charset(t){return this.meta={charset:t},this}keywords(...t){return this.meta=I("keywords",t.join(", ")),this}viewport(t){let r=l(t).map(([n,o])=>[M(n),String(o)].join("="));return this.meta=I("viewport",r.join(", ")),this}httpEquiv(t){return l(t).forEach(([r,n])=>{this.meta=Qr(M(r),String(n))}),this}robots(...t){return this.meta=I("robots",t.join(", ")),this}themeColor(t){return this.meta=I("theme-color",t),this}openGraph(t){return l(t).forEach(([r,n])=>{this.meta=Gr("og:"+r,String(n))}),this}twitter(t){return l(t).forEach(([r,n])=>{this.meta=I("twitter:"+r,String(n))}),this}push(t){this.metas.unshift(...t)}set meta(t){this.metas.push(t)}}class Mt{title;description;base;meta;link;script;css}var Kr=["charset","name","property","http-equiv"],sr=(t,r)=>{r.forEach((n)=>{for(let o of Kr)if(o in n){let i=n[o];t[`${o}_${o==="charset"?"":i}`]=n}})},zr=(t,r)=>{r.forEach((n)=>{if("href"in n){let o=n.href;t[`${o}`]=n}})};class G{_head;idm;constructor(t){this._head=new a(t)}set head(t){l(t).forEach(([r,n])=>{if(r==="title"||r==="base"){if(n!==void 0)this._head.set(r,n);return}if(n instanceof rt)return sr(this._head.init("meta",{}),n.metas);if(!g(n))return;switch(r){case"meta":return sr(this._head.init("meta",{}),n);case"link":return zr(this._head.init("link",{}),n);case"script":if(n.length){this._head.init(r,[]);let o=n.map((i)=>{if(!i.yid&&this.idm)i.yid="sc"+this.idm.mid;return i});this._head.get(r).push(...o)}return}})}get head(){return this._head}set id(t){this.idm=new D(t)}}var nt=(t)=>{return l(t??{}).reduce((r,[n,o])=>{return r.push(k(o)&&o?n:`${n}="${o}"`),r},[""]).join(" ")},fr=(t)=>{let r=new Set;if(!t)return"";let n=[...t].reduce((o,[i,e])=>{if(i==="meta"||i==="link")e=A(e);if(v(e)){if(i==="title")r.add(`<${i}>${e}</${i}>`);else o.add(`<${i}>${e}</${i}>`);return o}if(!g(e))return o;if(i==="base"){let s=e.slice(-1);if(s)return r.add(`<${i}${nt(s[0])}>`),o}return e.map((s)=>{if(i==="script"){let u={...s},h="";if("importmap"in u)u.type="importmap",h=JSON.stringify(u.importmap),delete u.importmap;else if("body"in u)h=u.body,delete u.body;return`<${i}${nt(u)}>${h}</${i}>`}return`<${i}${nt(s)}>`}).forEach((s)=>{if(s.includes('type="module"'))r.add(s);else if(s.includes("<meta"))r.add(s);else o.add(s)}),o},new Set);return[...r,...n].join("")};class ot{lang="en";htmlHead;head;constructor(){this.htmlHead=new a,this.head=(t={})=>{let r=new G(this.htmlHead),{css:n,description:o,...i}=t;if(o)r.head={meta:[{name:"description",content:o}]};if(n){let f=(g(n)?n:[n]).map((s)=>({rel:"preload stylesheet",href:s,as:"style"}));r.head={link:[...f]}}r.head=i,this.htmlHead=r.head}}}var jt=(t)=>{if(p)return;return new Promise((r,n)=>{let o=null;if(t.href)o=document.querySelector(`link[href="${t.href}"]`);if(o){r(o);return}let i=document.createElement("link");if(t.rel!=="stylesheet")t.rel="stylesheet",t.as="style";l(t).forEach(([e,f])=>{i.setAttribute(e,f)}),i.onload=()=>r(i),i.onerror=()=>n(new Error("Failed to load CSS")),document.head.appendChild(i)})},ur=(t)=>{if(p)return;return new Promise((r,n)=>{let o=document.createElement("script"),i="";if("importmap"in t)t.type="importmap",i=JSON.stringify(t.importmap),delete t.importmap;else if("body"in t)i=t.body,delete t.body;if(i)o.textContent=i;l(t).forEach(([e,f])=>{o.setAttribute(e,f)}),o.onload=()=>r(o),o.onerror=()=>n(new Error("Failed to load Script")),document.head.appendChild(o),requestAnimationFrame(()=>r("Script executed"))})},Nr=()=>{let r=document.querySelector("#d-css")?.sheet;if(r)return r;let n=document.createElement("style");return n.id="d-css",document.head.appendChild(n),n.sheet},Vr=(t,r)=>{for(let n=0;n<t.cssRules.length;n++)if(t.cssRules[n].selectorText===r)return!0;return!1},_r=(t)=>Object.entries(t).map(([r,n])=>`${M(r)}: ${n};`).join(" ");function Or(t,r={}){if(p)return;let n=Nr();if(!n)return;if(!Vr(n,t))n.insertRule(`${t} { ${_r(r)} }`,n.cssRules.length)}var Yt=(t,r=!1)=>{if(Z(t))return[+t,Rt(t)?"int":"float"];if(r&&/\.\w+$/.test(t))return[t,"file"];if(t==="/")return[t,"-"];if(t.length===36&&t.match(/\-/g)?.length===4)return[t,"uuid"];return[t,"string"]},Q=(t)=>{let r=t.startsWith("/")?t:"/"+t,n=r.match(/(?<=\/)[^/].*?(?=\/|$)/g)??["/"],[o,i]=n.reduce(([e,f],s)=>{if(s.includes("<")){let u=s.match(/(?<=<)[^/].*?(?=>|$)/g);if(u?.length){let[h,m]=u[0].split(":");if(h)e.push(h),f.push(m||"_")}}else e.push(s===">"?"/":s);return[e,f]},[[],[]]);if(r.endsWith("/")&&r.length>1)o.push("/");return{parsed:o,args:i}};class pt{storage;constructor(){this.storage=new a}cache(t,r){if(this.storage.lacks(t))this.storage.set(t,r());return this.storage.get(t)}}var hr=["int","float","file","uuid","string"],Tt=(t,r)=>{let n={},o=[],{parsed:i}=Q(t),{parsed:e,args:f}=Q(r);if(i.length===e.length)e.map((s,u)=>{let h=Yt(i[u],i.length-1===u);if(s===h[0])return h[0];if(hr.includes(h[1]))return o.push(h[0]),h[1];return s}),f.forEach((s,u)=>{n[s]=o[u]});return n};class K{_storage;CC;constructor(){this._storage=new a,this.CC=new pt}set(t){let{parsed:r,path:n}=t,o=S(r);if(!this._storage.get(o))this._storage.set(o,t);else throw`path: ${n} already used.`}get(t){let{parsed:r}=this.CC.cache(t,()=>Q(t)),n={},o=this._storage.get(S(r));if(!o&&t!=="/")for(let i of this._storage.keys()){let e=[],f=tr(i);if(r.length===f.length){let s=f.map((m,b)=>{let T=Yt(r[b],r.length-1===b);if(m===T[0])return T[0];if(hr.includes(T[1]))return e.push(T[0]),T[1];return m}),u=S(s);if(this._storage.has(u)){o=this._storage.get(u),o?.args.forEach((m,b)=>{n[m]=e[b]});break}}}return[o,n]}}class it{path="";parsed=[];args=[];constructor(t){ct(this,{path:t,...Q(t)})}}class Pt{date;constructor(t){this.date=t?new Date(t):new Date}delta(t=null,r=!1){let n=Pt.delta(this.date.getTime(),t);return r?new Date(n):n}timed(t){if(!t)return this.date;return[["year","FullYear"],["month","Month"],["day","Date"],["hour","Hours"],["minute","Minutes"],["second","Seconds"]].reduce((n,[o,i])=>{let e=t[o];return e?new Date(n[`set${i}`](n[`get${i}`]()+e)):n},new Date(this.date))}static delta(t,r=null){return r?r-t:t-Date.now()}static local(t){return new Date(t).toLocaleString()}static get now(){return Date.now()}}class Lt{static rand(t=6,r){if(r)return Math.floor(Math.random()*(r-t+1)+t);return Math.floor(Math.random()*t)+1-1}static fill(t,r=null){return Array(t).fill(r)}static new({dom:t,id:r,inner:n}){let o=document.createElement(t);if(r)o.id=r;if(n)o.innerHTML=n;return o}static randFrom(t){if(Array.isArray(t)){let r=t.length,n=this.rand(0,r-1);return t[n]}else if(typeof t=="object"){let r=W(t),n=r.length,o=this.rand(0,n-1);return r[o]}}static randArray(t=[],r=1,n=!1){let o=[],i=n?new Set:null;while((n?i.size:o.length)<r){let e=t[Lt.rand(0,t.length-1)];n?i.add(e):o.push(e)}return n?[...i]:o}static randomAZ=rr;static makeID=x;static class(t,...r){let n=r;if(t?.class)n.push(...g(t.class)?t.class:[t.class]);t.class=r}static get O(){return{vals:A,keys:W,items:l,has:or,ass:d,len:(t={})=>W(t).length}}static get is(){return At}static get return(){return ar}static sleep=(t=1000)=>new Promise((r)=>setTimeout(r,t));static get screen(){let{innerWidth:t}=window,r={xs:t<=480,sm:t>=480,smd:t>=624,md:t>=768,lg:t>=1024,xl:t>=1280,xxl:t>=1536},n=l(r).reverse();for(let o=0;o<n.length;o++){let[i,e]=n[o];if(e)return i}return}bytes(t){if(t===0)return"0 Bytes";let r=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,o)).toFixed(2))+" "+n[o]}static format(t){return new mr(t)}}class ar{static arr(t){return t?g(t)?t:[t]:[]}static num(t,r=0){let n=parseFloat(t);return isNaN(n)?r:n}static str(t){return String(t)}static arr2obj(t,r=!1){return t.reduce((n,o,i)=>{if(r)n[o]=i;else n[i]=o;return n},{})}}class mr{val;constructor(t){this.val=t}get px(){return`${this.val}px`}get rem(){return`${this.val}rem`}get pr(){return`${this.val}%`}}var Ct={},U={};class gr{stream;url;constructor(t,r){if(this.url=t,t in Ct)this.stream=Ct[t];else this.stream=new EventSource(t,{withCredentials:r}),Ct[t]=this.stream,U[this.url]={}}on(t){let r=this.stream;return l(t).forEach(([n,o])=>{if(n in U[this.url])U[this.url][n].forEach((i)=>{this.stream.removeEventListener(n,i)}),U[this.url][n]=[];if(r.addEventListener(n,o),!(n in U[this.url]))U[this.url][n]=[];U[this.url][n].push(o)}),this}}function lr(t,r=!0){return new gr(t,r)}class cr{value;constructor(t){this.value=t}get str(){return String(this.value).toString()=="null"?null:String(this.value).toString()}get int(){if(Z(this.value))return parseInt(this.value);else return null}get float(){if(Z(this.value))return parseFloat(this.value);else return null}get bool(){if(this.value==="true")return!0;else if(this.value=="false")return!1;else return null}get json(){if(this.value)return JSON.parse(this.value);return null}}class z{key;state;storage;constructor(t,r="local",n){if(this.storage=r=="local"?localStorage:sessionStorage,typeof t=="object"){let[o,i]=l(t)[0];if(this.key=o,this.state=i,n){let e=this.as[n];this.state.value=e}N((e)=>{this.set=e},[this.state],{id:this.key})}else this.key=t,this.state=null}get as(){return new cr(this.storage.getItem(this.key))}get value(){return this.storage.getItem(this.key)}set set(t){let r=E(t)?S(t):String(t);this.storage.setItem(this.key,r)}get remove(){this.storage.removeItem(this.key);return}}var dr={get:(t)=>new z(t,"local"),init:(t,r)=>new z(t,"local",r)};var pr={get:(t)=>new z(t,"session")};class bt extends it{id;cls;constructor(t,r,n){super(t);this.id=r;this.cls=n}}class Tr extends it{id;cls;constructor(t,r,n){super(t);this.id=r;this.cls=n}}class Zt extends ot{storage=new K;errorStorage=new K;wssStorage=new K;route;error;wss;base;constructor(t=""){super();this.base=t?t.startsWith("/")?t:`/${t}`:"",this.route=(r)=>{let n=this._base(r);return(o)=>{return o.route=n,this.storage.set(new bt(n,x(5),o)),o}},this.wss=(r)=>{let n=this._base(r);return(o)=>{return o.route=n,this.wssStorage.set(new Tr(n,x(5),o)),o}},this.error=(...r)=>{return(n)=>{if(r.length)r.forEach((o)=>{this.errorStorage.set(new bt(o.toString(),x(5),n))});else this.errorStorage.set(new bt("404",x(5),n));return n}}}_base(t){return nr(this.base,t)}async getPath(t){return this.storage.get(t)}async loadError(t){return this.errorStorage.get(t.toString())}async loadWSS(t){return this.wssStorage.get(t)}}var et=new a,V=(t)=>{if(p)return;let r=et.get(t);if(r?.isConnected)return r;et.delete(t);let n=document.getElementById(t);if(!n)return;return et.set(t,n),n};function br(){let t=[];return et.forEach((r,n)=>{if(!r.isConnected)t.push(n),et.delete(n)}),t}function N(t,r,{id:n="stateHook",init:o}={}){if(p)return()=>{};let i=[],e=()=>r.map((s)=>s.value),f=()=>{t(...e())};if(r.forEach((s)=>{i.push(s.hook(f)(n))}),o)f();return()=>{i.forEach((s)=>s())}}var yr=(t)=>{t.forEach((r)=>r())};var kr=(t,r)=>{for(let[n,o]of t){let i=V(n);if(!i){t.delete(n);continue}o.forEach((e)=>{e.call(i,r)})}};class j extends EventTarget{options;deep;verify;hooks=new a;states=new a;_value;listening=!1;end;constructor(t,r={},n=!0,o=!0){super();this.options=r;this.deep=n;this.verify=o;this._value=t}get value(){return this._value}set value(t){if(!this.verify){this._value=t,this.dispatchEvent(new CustomEvent("updated",{detail:this._value}));return}if(!this.deep){if(this._value===t)return;this._value=t,this.dispatchEvent(new CustomEvent("updated",{detail:this._value}));return}if(H(this._value)||g(this._value)){let r=Ht(this._value,t);if(!er(r))return}else if(this._value instanceof Set){if(!ir(this._value,t))return}else if(this._value===t)return;this._value=t,this.dispatchEvent(new CustomEvent("updated",{detail:this._value}))}get listen(){let t=(r)=>{if(yr(this.hooks),kr(this.states,r.detail),!this.states.size&&!this.hooks.size)this.end?.()};if(!this.listening)this.addEventListener("updated",t,this.options),this.listening=!0;return()=>{this.listening&&this.removeEventListener("updated",t,this.options),this.end=void 0,this.listening=!1}}call(t,r){return(n)=>{if(dt(n,this.states).set(r,t),!p&&!this.listening)this.end=this.listen;return()=>{if(this.states.has(n))this.states.get(n)?.delete(r)}}}hook(t){return(r)=>{if(this.hooks.set(r,t),!p&&!this.listening)this.end=this.listen;return()=>{if(this.hooks.has(r))this.hooks.delete(r)}}}}function Y(t,r={}){return new j(t,r,!0)}function vr(t,r=!1){return new j(t,{},!1,r)}var _=(t)=>{if(g(t))return t.filter((r)=>r!==void 0).join(" ");else if(E(t)){if(H(t))return S(t)}else if(w(t))return _(t());else if(t!==void 0&&t!==null)return k(t)?t?"":"false":String(t);return""};function tn(t,r){switch(r??t){case"style":return function(n){this.style.setProperty(t,n)};default:return function(n){this.setAttribute(t,n)}}}class Ft{attr;constructor(t={}){this.attr=t}get(t,r=this.attr,n){let o=(i,e)=>{if(g(e))t.attr_push(i,_(e));else if(e instanceof j){let f=n?`${n}_${i}`:i;t.states.push(e.call(tn(i,n),f)),o(i,e.value)}else if(E(e)){if(H(e)&&!n)this.get(t,e,i)}else t.attr_push(i,_(e),n)};l(r).forEach(([i,e])=>{if(i==="ref"){if(e instanceof st)t.events.obj({element(){e.element=this}})}else if(["on"].includes(i))E(r.on)&&t.events.obj(r.on);else o(i,e)})}unload(t){let r=void 0;if(t in this.attr)r=this.attr[t],delete this.attr[t];return r}}class F{xid;IDM;map=new a;states=[];events=new a;OZ;constructor(t,r=new D,n){this.xid=t;this.IDM=r;this.OZ=n??new yt}attr_push(t,r,n){let o=n??t;if(!this.map.has(o))this.map.set(o,[]);let i=n?`${M(t)}:${r};`:r;this.map.get(o).push(i)}get attr(){let t=[""];return this.map.forEach((r,n)=>{let o=r.join("");t.push(o?`${n}="${o}"`:n)}),t.join(" ")}set id(t){if(!this.map.has("id"))this.map.set("id",[t])}get id(){return this.map.get("id")?.join("")}}var rn=(t,r,n)=>{return t.addEventListener(r,n),()=>{t.removeEventListener(r,n)}},ft={};class yt{events=new a;states=new a;winStates=new a;windowEvents=new a;resetST=new a;resetEV=new a;constructor(){}get keys(){return[...new Set([...this.states.keys(),...this.events.keys()])]}set(t){let{id:r,events:n,states:o}=t;if(r){if(n.size)this.events.set(r,n);if(o.length)this.states.set(r,o)}return this}push(t){return t.events.forEach((r,n)=>{r.forEach((o,i)=>{dt(n,this.events).set(i,o)})}),t.states.forEach((r,n)=>{tt(n,this.states).push(...r)}),this}get stage(){return this.events.forEach((t,r)=>{this.events.delete(r);let n=V(r);if(!n){this.events.delete(r);return}t.forEach((o,i)=>{switch(i){case"ready":case"element":o.apply(n,[n]);break;case"resize":case"beforeunload":case"popstate":case"winscroll":case"winload":case"winfocus":case"winblur":let e=i.replace(/^win/,"");this.windowEvents.init(e,new a).set(r,o);break;case"state":let[f,s,u]=o.apply(n,[n]),h=g(s)?s:[s];if(!h.length)break;let m=()=>h.map((T)=>T.value),b=()=>f(...m());if(u)b();h.forEach((T)=>tt(r,this.resetST).push(T.call(b,r+"_state")(r)));break;default:tt(r,this.resetEV).push(rn(n,i,o))}})}),this.processWindowEvents,this.states.forEach((t,r)=>{this.states.delete(r),t.forEach((n)=>{tt(r,this.resetST).push(n(r))})}),this}get processWindowEvents(){let t=(r,n)=>{let o=0,i=!1,e=(s)=>{if(o=window.scrollY,!i)window.requestAnimationFrame(()=>{n.forEach((u,h)=>{let m=V(h);if(m)u.call(m,s);else this.windowEvents.get(r)?.delete(h)}),i=!1}),i=!0},f=(s)=>{n.forEach((u,h)=>{let m=V(h);if(m)u.call(m,s);else this.windowEvents.get(r)?.delete(h)})};return window.addEventListener(r,r==="scroll"?e:f),()=>{window.removeEventListener(r,r==="scroll"?e:f)}};return this.windowEvents.forEach((r,n)=>{if(r.size){if(!ft[n])ft[n]=t(n,r)}else if(ft[n])ft[n](),delete ft[n]}),this}reset(t){return t.forEach((r)=>{this.windowEvents.forEach((n,o)=>{if(n.has(r))n.delete(r)}),this.resetEV.get(r)?.forEach((n)=>{n()}),this.resetST.get(r)?.forEach((n)=>{n()}),this.resetST.delete(r),this.resetEV.delete(r)}),this}RPS(t){if(t){let r=br();this.reset(r);let n=t.keys;if(n.length)this.reset(n).push(t).stage}return this}}var P=new yt;var nn=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],on=(t)=>nn.includes(t);function en(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var xt=(t,r)=>{if(g(t))return t.map((n)=>xt(n,r)).join("");else if(t instanceof ht){let n=t.__(r.IDM),{ctx:o,oz:i}=n;return r.OZ.push(i),o}else if(E(t))return S(t);else if(w(t))return xt(t(),r);else if(t!==void 0&&t!==null)return en(t);return""},wt=(t,r)=>{let n=new D(r),o=new F(n.id,n);return{ctx:xt(t,o),catt:o}};function sn(t){let r=this.id;if(r){let{ctx:n,catt:o}=wt(t,r);if(this.innerHTML!==n)this.innerHTML=n,P.RPS(o.OZ)}}var ut=(t,r,n,o=[])=>{if(g(t))t.forEach((i)=>{ut(i,t.length,n,o)});else if(t instanceof j)if(r>1)ut(B("div",{},t),r,n,o);else{let i=t.value,e=i instanceof ht?"dom":"ctx",{ctx:f,catt:s}=wt(i,n.xid+"-0");n.xid=s.xid,o.push(f),n.OZ.push(s.OZ),n.states.push(t.call(sn,e))}else o.push(xt(t,n))};class Bt{tag;ctx;closing;constructor(t,r){this.tag=t;this.ctx=r;let n=on(t);this.closing=n?"":`</${t}>`}process(t,r=this.ctx,n=[]){return r.forEach((o)=>{ut(o,r.length,t,n)}),n.join("")}get(t){let r=this.process(t);if(t.events.size||t.states.length)t.id=t.xid;return`<${this.tag}${t.attr}>${r}${this.closing}`}}class ht{tag;constructor(t,r={},...n){this.tag=t;ct(this,{attr:new Ft(r),ctx:new Bt(t,n)})}__(t=new D){let r=t.mid,n=new F(r,t);return this.attr.get(n),{ctx:this.ctx.get(n),oz:n.OZ.set(n),id:n.id}}}function B(t,r={},...n){if(w(t))return $.i=t,t(r??{},...n);return new ht(t,r??{},n)}var fn=(t,...r)=>r;class Xt{e;opt;constructor(t){this.e=t;this.opt={duration:500,easing:"ease-in-out",fill:"forwards"}}animate(t,r={}){return this.e.animate(t,r)}get slide(){let t=({x:r=0,y:n=0},o={})=>{d(this.opt,o);let i=[[r,n],[0,0]].map(([e,f])=>({transform:`translateX(${e}rem) translateY(${f}rem)`}));return this.e.animate(i,this.opt),this};return{left:(r={})=>{return t({x:-2},r)},right:(r={})=>{return t({x:2},r)},up:(r={})=>{return t({y:2},r)},down:(r={})=>{return t({y:-2},r)}}}fade(t={}){d(this.opt,t);let r=[0,1].map((n)=>({opacity:n}));return this.e.animate(r,this.opt),this}shake(t="Y",r={}){d(this.opt,r);let n=[0,5,-5,5,0].map((o)=>({transform:`translate${t}(${o}px)`}));return this.e.animate(n,this.opt),this}color(t=[],r={}){d(this.opt,r);let n=Array.isArray(t)?t.map((o)=>({color:o})):{color:t};return this.e.animate(n,this.opt),this}bg(t=[],r={}){d(this.opt,r);let n=Array.isArray(t)?t.map((o)=>({backgroundColor:o})):{backgroundColor:t};return this.e.animate(n,this.opt),this}bounce(t=1,r={}){d(this.opt,r);let n=[0.5,t,1].map((o)=>({transform:`scale(${o})`}));return this.e.animate(n),this}}class Ut{e;query;constructor(t,r){this.e=t;this.query=r}get a(){return new Xt(this)}get all(){if(this.query){let t=document.querySelectorAll(this.query);if(t.length)return Array.from(t).map((r)=>r)}return[]}get attr(){let t=this.e;return{has:(r)=>{return t.hasAttribute(r)},get:(r)=>{return t.getAttribute(r)},del:(r)=>{return t.removeAttribute(r),this},set:(r)=>{for(let n in r){let o=r[n];if(r[n]!==void 0)t.setAttribute(n,_(o))}return this}}}get children(){return Array.from(this.e.children).map((t)=>c(t))}get click(){return this.e.click(),this}get delete(){return this.e.remove(),this}get disabled(){return this.e.disabled??!1}get focus(){return this.e.focus(),this}get href(){return this.e?.href??""}get id(){return this.e.id}get inner(){return this.e.innerHTML}get offsetParent(){let t=this.e.offsetParent;if(t)return new L(t);return}get parent(){let t=this.e.parentElement;if(t)return new L(t);return}get hash(){return this.e?.hash??""}get path(){return this.e?.pathname??""}get rect(){return this.e.getBoundingClientRect()}get remove_element(){return this.e.remove(),this}get style(){let t=this.e.style,r=this;return{set:(n,o=0)=>{let i=t,e=()=>{l(n).forEach(([f,s])=>{if(f in i){if(i[f]!==s)i[f]=s}else if(s!==null)t.setProperty(f,String(s))})};if(w(o))r.on("transitionend",o);if(St(o))setTimeout(e,o);else e();return r},get:(n)=>{let o=M(String(n));return t.getPropertyValue(o)},del:(...n)=>{n.forEach((o)=>{let i=M(String(o));t.removeProperty(i)})}}}get submit(){let t=this.e;if("submit"in t)return t.submit();return!1}get tag(){return this.e.tagName.toLowerCase()}get value(){return this.e.value??""}get unload(){return()=>{this.e.remove()}}set append(t){let{ctx:r,oz:n}=qt(t,It(this.id));this.e.insertAdjacentHTML("beforeend",r),P.RPS(n)}set appendfirst(t){let{ctx:r,oz:n}=qt(t,It(this.id));this.e.insertAdjacentHTML("afterbegin",r),P.RPS(n)}set inner(t){let{ctx:r,oz:n}=qt(t,It(this.id));this.e.innerHTML=r,P.RPS(n)}set disabled(t){let r=this.e;if("disabled"in r)r.disabled=t}set id(t){this.e.id=t}set value(t){let r=this.e;r.value=t}}var qt=(t,r)=>{let{ctx:n,catt:o}=wt(t,r);return{ctx:n,oz:o.OZ}},It=(t)=>t?`${t}-0`:t;class L extends Ut{constructor(t,r){super(t,r)}add(...t){return this.e.classList.add(...t.map((r)=>r.replace(/[^\w-]/,""))),()=>{this.e.classList.remove(...t.map((r)=>r.replace(/[^\w-]/,"")))}}remove(...t){return this.e.classList.remove(...t.map((r)=>r.replace(/[^\w-]/,""))),this}toggle(t,r){let n=typeof t!="string"?t.apply(this):t;return this.e.classList.toggle(n,r)}hasNode(t){return this.e.contains(t)}has(...t){let r=this.e.classList;return t.every((n)=>r.contains(n))}insert(t){return{HTML:(...r)=>{return r.forEach((n)=>{this.e.insertAdjacentHTML(t,n)}),this},element:(...r)=>{return r.forEach((n)=>{this.e.insertAdjacentElement(t,n)}),this},text:function(...r){return r.forEach((n)=>{this.e.insertAdjacentText(t,n)}),this}}}is(t){let r=this.e.classList,n=this.e.tagName.toLocaleLowerCase(),o=!0,i=!0;if(t.dom)i=t.dom==n?!0:!1;if(t.class)if(Array.isArray(t.class))t.class.forEach((e)=>{o=o?r.contains(e):!1});else o=o?r.contains(t.class):!1;return o&&i}on(t,r,n=!1){let o=!1;if(t.indexOf("touch")>-1)o=!0;return this.e.addEventListener(t,r,{capture:n,passive:o}),this}remove_on(t,r,n=!1){return this.e.removeEventListener(t,r,n),this}timed(t,r=250){return setTimeout(()=>t(this),r),this}animate(t,r,n){let o={duration:300,easing:"ease",fill:"forwards"};if(w(r))n=r;else d(o,r);let i=this.e.animate(t,o);if(n)i.finished.then(n);return this}}function c(t,r){let n=r?r:document;if(v(t)){let o=n.querySelector(t);if(o)return new L(o,t);return}else if(H(t)){let[[o,i]]=l(t),f=`${o==="id"?"#":"."}${i}`,s=n.querySelector(f);if(s)return new L(s,f);return}else return new L(t)}class st{state=new j(void 0);constructor(){}get element(){return this.state.value?.e}set element(t){if(t)this.state.value=new L(t);else this.state.value=void 0}get $(){return this.state.value}}var un=()=>{return new st};class Jt{lang;head="";constructor(t,r){if(this.lang=t,r)this.head=fr(r)}body(t,r,n){return[`<!DOCTYPE html><html lang="${this.lang}">`,`<head>${this.head}</head>`,`<body id="${r??x(5)}"${n?" "+n:""}>${t}</body>`,"</html>"].join("")}}class $t extends Mt{path;args;id;status;lang;import;_data={};static route="/";constructor(t,r={},n,o=200){super();this.path=t;this.args=r;this.id=n;this.status=o}async loader(){if(this.import)try{let t=await this.import;if(t.default)this.import=await t.default({...this.args,...this.data});else this.import=void 0}catch(t){return $.e=["import",{error:"loader"}],this.import=void 0,[]}if(this.body){let t=await this.body();return g(t)?t:[t]}if(this.import){let t=this.import;return g(t)?t:[t]}return[]}getHeadAttr(t={},...r){let n=new G;if(R(t))n.head=t;n.id=this.id;let o=n.head;return r.forEach((i)=>{o.map(i)}),hn(n,this),o}set data(t){d(this._data,t)}get data(){return this._data}}class Wt extends $t{head(){this.title=`error ${this.status}`}body(){return B("div",{},this.path+" not found...")}}function hn(t,r){let{link:n,script:o,meta:i,title:e,base:f,description:s,css:u}=r;if(t.head={title:e,base:f,meta:i,link:n,script:o},s)t.head={meta:[{name:"description",content:s}]};if(u){let m=(g(u)?u:[u]).map((b)=>({rel:"preload stylesheet",href:b,as:"style"}));t.head={link:[...m]}}}function xr(t){let r=[];if(t?.length){let{href:n,target:o}=t[0],i=c("base");if(i){if(i.attr.get("href")!==n)i.attr.set({href:n,target:o})}else{let e=c(document.createElement("base"));e.attr.set({href:n,target:o}),document.head.append(e.e)}}return r}var wr=new a;async function $r(t,r={},n=!1){let o=at.value,i={};if(c("link")?.all.forEach((e)=>{let f=c(e),s=f.attr.get("href");if(s){let u=f.attr.get("rt");if(n){let h=wr.get(o);if(h){if(!h.has(s))i[s]=f.unload}else i[s]=f.unload}else if(u){if(u===t)i[s]=f.unload}}}),r&&R(r))for(let e of A(r)){let f=e.href;if(!(f in i))try{let s=void 0;if(!n){if(s=c(`link[href='${f}']`),s)s.attr.set({rt:t});e.rt=t;let u=wr.init(o,new Set);if(!u.has(f))u.add(f)}if(!s)await jt(e)}catch(s){$.e=["link error",{error:"yvee @ link"}]}else delete i[f]}return A(i)}var an=["charset","name","property","http-equiv"];function Er(t){let r={};if(c("meta")?.all.forEach((n)=>{let o=n.attributes;for(let i of an)if(i in o){let e=o[i].value;r[`${i}_${i==="charset"?"":e}`]=n}}),t)l(t).forEach(([n,o])=>{if(n in r)c(r[n]).attr.set(o),delete r[n];else{let i=c(document.createElement("meta"));i.attr.set(o),document.head.append(i.e)}});return A(r).map((n)=>c(n).unload)}var Sr=new a;async function Rr(t,r,n=!1){let o=at.value,i={};if(c("script[yid]")?.all.forEach((e)=>{let f=c(e),s=f.attr.get("yid");if(s){let u=f.attr.get("rt");if(n){let h=Sr.get(o);if(h){if(!h.has(s))i[s]=f.unload}else i[s]=f.unload}else if(u){if(u===t)i[s]=f.unload}}}),r){for(let e of r)if("yid"in e)if(e.yid in i)delete i[e.yid];else try{if(!n){e.rt=t;let f=e.yid,s=Sr.init(o,new Set);if(!s.has(f))s.add(f)}await ur(e)}catch(f){$.e=["script error",{error:"yvee @ script"}]}}return A(i)}async function Ar(t,r){let n=[];if(p)return[];let o=t.get("title")??"",{pushState:i}=this.config;if(i){let e=this.path.value,f=this.lastPath.value;if(f!==e)if(!f.startsWith(e))X(e,o);else if(e===this.base)X(e,o);else X(e,o)}if(o&&(document.title=o),this.isYvee)document.documentElement.lang=r,n.push(...xr(t.get("base"))),n.push(...Er(t.get("meta")));return n.push(...await $r(this.id,t.get("link"),this.isYvee)),n.push(...await Rr(this.id,t.get("script"),this.isYvee)),n}function X(t,r){if(p)return;let{pathname:n,hash:o}=window.location,i=n+o;if(t&&i!==t)history.pushState({},r??"",t)}class Gt{path;args;static route="/";isConnected=Y(!1);data={};constructor(t,r={}){this.path=t;this.args=r;this.data=r}open(t){}message(t){}close(t){}error(t){}get connect(){if(this.ws&&this.ws.readyState<=1)return this;return this.ws=new WebSocket(this.path),this.ws.onopen=async(t)=>{this.isConnected.value=!0,await this.open.call(this,t)},this.ws.onmessage=async(t)=>{await this.message.call(this,t)},this.ws.onclose=async(t)=>{this.isConnected.value=!1,await this.close.call(this,t)},this.ws.onerror=async(t)=>{this.isConnected.value=this.ws.readyState<=1,await this.error.call(this,t)},this}get reconnect(){if(this.state>=2)this.connect;return this}get disconnect(){if(this.state<=1)this.ws.close();return this}get state(){return this.ws?.readyState??3}set send(t){if(this.isConnected.value)this.ws.send(t);else throw new Error(`websocket path ${this.path} not connected`)}}var O=new a;class Qt{yvee;constructor(t){this.yvee=t}async load(t){if(p)return;if(!O.has(t)){let[n,o]=await this.yvee.loadWSS(t);if(!n)return;let{cls:i,path:e,id:f}=n,s=new i(e,o).connect;return O.set(t,s),s}let r=O.get(t);return r.reconnect,r}unload(t){if(p)return;if(O.has(t)){let r=O.get(t);if(!r)return;r.disconnect,O.delete(t)}}}var Kt=new a;function mn(t,r,n,o){let{on:i,top:e,topRef:f,...s}=t,u={...i??{},click(h){h.preventDefault();let m=c(this),b=m.path;o.value=n.value,n.value=b;let T=m.hash;if(T){let J=c(T),y=window.scrollY;if(J)y+=J.rect.top;if(f)y-=f?.value?.e.offsetHeight||0;if(e)if(typeof e==="number")y-=e;else y-=e();window.scrollTo({top:y,behavior:"smooth"}),X(b+T)}else if(o.value===n.value)window.scrollTo({top:m.rect.top||0,behavior:"smooth"}),X(window.location.pathname)}};return B("a",{...s,on:{...u}},...r)}function gn(t,r,n){let{classes:o}=t.config,{on:i,...e}=r,f={...r.on??{},...n&&{popstate(s){let h=s.target.location.pathname;t.path.value=h}},...{element(s){t.mainElement=this}}};return B("div",{...e,...o&&{class:o},on:f},t.root)}async function ln(t,r){let[n,o]=await this.loadError(r??0);if(n){let{cls:i,id:e}=n;return new i(t,o,e,r)}else{let i=new Wt(t,o,x(5));return i.title=`error ${r}`,i}}function zt(){if(q)return parseInt(c('meta[name="error"]')?.attr.get("content")??"200");return 200}class mt extends Zt{config;hook;root=Y([]);socket;id=x(4);path=Y("");lastPath=Y("");loading=Y(!1);mainElement;A;Main;load;matchPath;isYvee=!1;constructor(t={},r={}){super(t.base??"");this.config=t;if(this.socket=new Qt(this),t.id)this.id=t.id;this.A=(n,...o)=>{if(this.base){if(!n.href.startsWith(this.base))n.href=this._base(n.href)}return mn(n,o,this.path,this.lastPath)},this.Main=(n)=>{if(R(r))if(!n.on)n.on=r;else d(n.on,r);return gn(this,n,this.isYvee)},this.load=async(n,o={})=>{if(this.hook)this.hook();if(n){this.path.value=n,this.lastPath.value=n;try{await this.render(n,404,o),this.hooker()}catch(i){$.e=["render error",{error:"Pager loader"}]}}return this},this.matchPath=(n)=>{let o=this._base(n),i=this.path.value,e=this.base;if(i===o)return!0;else{let f=i.replace(e,""),s=o.replace(e,"");if(s){if(f.startsWith(s))return!0}else if(!i)return!0}return!1}}hooker(){let t={},r={},n=this.path.value;if(this.hook)this.hook();this.hook=N(async(o)=>{if(r[n]=window.scrollY,t[n]=this.mainElement?.scrollTop??0,(await this.render(o,404)).done){let i=r[o]??0;if(i)window.scrollTo({top:i,behavior:"instant"});let e=t[o]??0;if(e)this.mainElement?.scrollTo({top:e,behavior:"instant"});n=o}},[this.path],{id:"router"})}async class(t,r,n=!1){let[o,i]=await this.getPath(t);if(o&&!n){let{cls:e,id:f}=o;return new e(t,i,f)}else return await ln.call(this,t,404)}async fetch(t){if(t)try{if(t.fetch){let r=await t.fetch();if(H(r)&&R(r))t.data=r}}catch(r){$.e=["class fetch",{error:"fetch"}]}}async processHead(t,r={}){return t?await this.processClassHead(t,r):await this.processDefaultHead(r)}async processClassHead(t,r){if(t.head)await t.head();return t.getHeadAttr(r,this.htmlHead)}async processDefaultHead(t){let r=new G;if(R(t))r.head=t;return r.head.map(this.htmlHead),r.head}async render(t,r=404,n={},o={},i=!0,e=!1){let f=await this.class(t,r??zt(),e);f.data=n,await this.fetch(f);let s=await this.processHead(f,o);if(p)Kt.set(this.id,s);if(!f)return{lang:this.lang,heads:s,done:!1};let u=[];if(this.loading.value=!0,this.isYvee)u=await f.loader();let h=[];if(i)h=await Ar.call(this,s,f?.lang||this.lang);if(!this.isYvee)u=await f.loader(),h.forEach((m)=>m());if(this.isYvee)h.forEach((m)=>m());if(u.length)this.root.value=u;else await this.render(t,r,n,o,i,!0);return this.loading.value=!1,{heads:s,lang:f.lang??this.lang,done:!0}}}var at=Y("");class Et extends mt{config;isYvee=!0;unload=!0;constructor(t={},r={}){super(t,r);this.config=t;this.path=at,this.load=async(n,o={})=>{if(q)n=dn()||this._base(n??"/");if(this.hook)this.hook();if(n){this.path.value=n,this.lastPath.value=n;try{await this.render(n,404,o),this.hooker()}catch(i){$.e=["render error",{error:"Yvee loader"}]}}return this}}}var cn=(t)=>{return(r)=>{t(r)}};function dn(){if(q)return c('meta[name="yvee"]')?.attr.get("content")??"/";return""}var Dr=(t,r,n,o=!1)=>{let i=[];if(i.push({charset:"utf-8"}),i.push({name:"viewport",content:"width=device-width, initial-scale=1.0"}),n)switch(n){case 404:i.push({name:"error",content:n.toString()});break;default:break}if(o)i.push({name:"yvee",content:r});if(t.meta)if(g(t.meta))t.meta.unshift(...i);else t.meta.push(i);else t.meta=i},Hr=async(t,r,n={},o=[])=>{let i=await r(n),e=g(i)?i:[i],f=new F(t,new D(t));return e.forEach((s)=>{ut(s,e.length,f,o)}),f.OZ.set(f),f.OZ};async function pn(t,r,n={}){let{bodyattr:o={},id:i,route:e,base:f="",index:s,data:u}=n;if(q){let h={},m=window.location.pathname,b=document.body.id;if(r)if(r instanceof Et)await r.load();else{if(u)if(w(u))h=await u();else h=u;if(e){if(e.length>1&&e.slice(-1)!=="/")m=m.replace(/^\/|\/$/g,"");d(h,Tt(m,e))}d(h,{path:m,status:zt()})}let T=await Hr(b,t,h);P.push(T),requestAnimationFrame(()=>{P.stage})}return async({path:h,data:m={},status:b=200})=>{let T=x(4),J=new a,y={};if(i)T=i;if(o.id)T=o.id.toString();let Nt="en";if(r instanceof Et){let{base:C,path:gt,id:Mr,lang:jr}=r;if(y.base=[{href:C==="/"?C:`${C}/`,target:"_blank"}],y.script)y.script.push({type:"module",src:"./index.js"});else y.script=[{type:"module",src:"./index.js"}];gt.value=h,Dr(y,h,b,!0);let{heads:_t}=await r.render(h,b,m,y,!1);Kt.values().forEach((Yr)=>{d(_t.init("link",{}),Yr.get("link")??{})}),T=Mr,J=_t,Nt=jr}else{let C=h==="/"?h:`${h}/`;if(s)C=`${s}/`;if(f)C=`${f}${C}`;if(y.base=[{href:C,target:"_self"}],y.script)y.script.push({type:"module",src:"./index.js"});else y.script=[{type:"module",src:"./index.js"}];if(e)d(m,Tt(h,e));d(m,{status:b,path:h,base:f}),d(y,w(r)?await r(m):r),Dr(y,h,b);let gt=new ot;gt.head(y),J=gt.htmlHead}let Vt=[];return await Hr(T,t,m,Vt),new Jt(Nt,J).body(Vt.join(""),T,nt(o))}}var Us=(t,r)=>{return`${t.replace(/\/+$/,"")}/${r.replace(/^\.\/+/,"")}`},Js=(t)=>{if(p)return;return t()};export{Gt as websocket,un as useRef,pr as session,Us as resolvePath,X as pushHistory,$ as log,dr as local,fn as frag,lr as eventStream,B as dom,$t as doc,jt as cssLoader,Or as addCSS,Lt as __,Et as Yvee,Pt as Time,j as Stateful,N as StateHook,Y as State,cn as Routes,pn as Render,st as Ref,vr as QState,mt as Pager,rt as Meta,Js as IfClient,c as $};
